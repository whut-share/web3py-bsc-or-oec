import sys
sys.path.append("..")

import json

from public.web3_utils import Web3Utils

class Bsw:
    '''BSW聚合器工具类

    本类提供鱿鱼游戏通用方法
    本类提供BSW聚合器交易质押等方法

    Attributes:
        web3Utils(Web3Utils): Web3Utils对象
        bspAddress(str): 玩家合约地址
        bsbAddress(str): 车辆合约地址
        gameAddress(str): 游戏合约地址
        bspAbi(json): 玩家合约abi
        bsbAbi(json): 车辆合约abi
        gameAbi(json): 游戏合约abi
        bspContract(Contract): 玩家合约
        bsbContract(Contract): 车辆合约
        gameContract(Contract): 游戏合约
    '''
    pass

    web3Utils = Web3Utils("https://bsc-dataseed.binance.org/", 5, 56)

    bspAddress = "0xb00ed7e3671af2675c551a1c26ffdcc5b425359b"

    bsbAddress = "0x6d57712416eD4890e114A37E2D84AB8f9CEe4752"

    gameAddress = "0xCCc78DF56470b70cb901FCc324A8fBbE8Ab5304B"

    bspAbi = json.loads('[{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bool","name":"state","type":"bool"},{"indexed":false,"internalType":"uint256","name":"seDivide","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"gracePeriod","type":"uint256"}],"name":"ChangeSEDivideState","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"baseURI","type":"string"}],"name":"Initialize","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256[]","name":"_tokenId","type":"uint256[]"},{"indexed":false,"internalType":"uint32","name":"contractEndTimestamp","type":"uint32"}],"name":"NewContract","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"previousAdminRole","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"newAdminRole","type":"bytes32"}],"name":"RoleAdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleGranted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleRevoked","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256[]","name":"_tokenId","type":"uint256[]"},{"indexed":false,"internalType":"uint128[]","name":"addition","type":"uint128[]"}],"name":"SEIncrease","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint8","name":"rarity","type":"uint8"},{"indexed":false,"internalType":"uint128","name":"squidEnergy","type":"uint128"}],"name":"TokenMint","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256[]","name":"_tokenId","type":"uint256[]"},{"indexed":false,"internalType":"uint32","name":"busyTo","type":"uint32"},{"indexed":false,"internalType":"uint128[]","name":"decreaseSE","type":"uint128[]"}],"name":"TokensLock","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[],"name":"DEFAULT_ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"GAME_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"SE_BOOST_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TOKEN_FREEZER","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TOKEN_MINTER_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"uint256","name":"_from","type":"uint256"},{"internalType":"uint256","name":"_to","type":"uint256"}],"name":"arrayUserPlayers","outputs":[{"components":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint8","name":"rarity","type":"uint8"},{"internalType":"address","name":"tokenOwner","type":"address"},{"internalType":"uint128","name":"squidEnergy","type":"uint128"},{"internalType":"uint128","name":"maxSquidEnergy","type":"uint128"},{"internalType":"uint32","name":"contractEndTimestamp","type":"uint32"},{"internalType":"uint32","name":"busyTo","type":"uint32"},{"internalType":"uint32","name":"createTimestamp","type":"uint32"},{"internalType":"bool","name":"stakeFreeze","type":"bool"},{"internalType":"string","name":"uri","type":"string"}],"internalType":"struct SquidPlayerNFT.TokensViewFront[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"arrayUserPlayers","outputs":[{"components":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint8","name":"rarity","type":"uint8"},{"internalType":"address","name":"tokenOwner","type":"address"},{"internalType":"uint128","name":"squidEnergy","type":"uint128"},{"internalType":"uint128","name":"maxSquidEnergy","type":"uint128"},{"internalType":"uint32","name":"contractEndTimestamp","type":"uint32"},{"internalType":"uint32","name":"busyTo","type":"uint32"},{"internalType":"uint32","name":"createTimestamp","type":"uint32"},{"internalType":"bool","name":"stakeFreeze","type":"bool"},{"internalType":"string","name":"uri","type":"string"}],"internalType":"struct SquidPlayerNFT.TokensViewFront[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"uint256","name":"_from","type":"uint256"},{"internalType":"uint256","name":"_to","type":"uint256"}],"name":"arrayUserPlayersWithValidContracts","outputs":[{"components":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint8","name":"rarity","type":"uint8"},{"internalType":"address","name":"tokenOwner","type":"address"},{"internalType":"uint128","name":"squidEnergy","type":"uint128"},{"internalType":"uint128","name":"maxSquidEnergy","type":"uint128"},{"internalType":"uint32","name":"contractEndTimestamp","type":"uint32"},{"internalType":"uint32","name":"busyTo","type":"uint32"},{"internalType":"uint32","name":"createTimestamp","type":"uint32"},{"internalType":"bool","name":"stakeFreeze","type":"bool"},{"internalType":"string","name":"uri","type":"string"}],"internalType":"struct SquidPlayerNFT.TokensViewFront[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"arrayUserPlayersWithValidContracts","outputs":[{"components":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint8","name":"rarity","type":"uint8"},{"internalType":"address","name":"tokenOwner","type":"address"},{"internalType":"uint128","name":"squidEnergy","type":"uint128"},{"internalType":"uint128","name":"maxSquidEnergy","type":"uint128"},{"internalType":"uint32","name":"contractEndTimestamp","type":"uint32"},{"internalType":"uint32","name":"busyTo","type":"uint32"},{"internalType":"uint32","name":"createTimestamp","type":"uint32"},{"internalType":"bool","name":"stakeFreeze","type":"bool"},{"internalType":"string","name":"uri","type":"string"}],"internalType":"struct SquidPlayerNFT.TokensViewFront[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"availableSEAmount","outputs":[{"internalType":"uint128","name":"amount","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"burn","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"enableSeDivide","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleAdmin","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"getToken","outputs":[{"components":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint8","name":"rarity","type":"uint8"},{"internalType":"address","name":"tokenOwner","type":"address"},{"internalType":"uint128","name":"squidEnergy","type":"uint128"},{"internalType":"uint128","name":"maxSquidEnergy","type":"uint128"},{"internalType":"uint32","name":"contractEndTimestamp","type":"uint32"},{"internalType":"uint32","name":"busyTo","type":"uint32"},{"internalType":"uint32","name":"createTimestamp","type":"uint32"},{"internalType":"bool","name":"stakeFreeze","type":"bool"},{"internalType":"string","name":"uri","type":"string"}],"internalType":"struct SquidPlayerNFT.TokensViewFront","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"gracePeriod","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"grantRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"hasRole","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"baseURI","type":"string"},{"internalType":"uint128","name":"_seDivide","type":"uint128"},{"internalType":"uint256","name":"_gracePeriod","type":"uint256"},{"internalType":"bool","name":"_enableSeDivide","type":"bool"}],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"tokenId","type":"uint256[]"},{"internalType":"uint32","name":"busyTo","type":"uint32"},{"internalType":"bool","name":"willDecrease","type":"bool"},{"internalType":"address","name":"user","type":"address"}],"name":"lockTokens","outputs":[{"internalType":"uint128","name":"","type":"uint128"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint128","name":"squidEnergy","type":"uint128"},{"internalType":"uint32","name":"contractEndTimestamp","type":"uint32"},{"internalType":"uint8","name":"rarity","type":"uint8"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"renounceRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"revokeRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"seDivide","outputs":[{"internalType":"uint128","name":"","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"newBaseUri","type":"string"}],"name":"setBaseURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"tokenId","type":"uint256[]"},{"internalType":"uint32","name":"contractEndTimestamp","type":"uint32"},{"internalType":"address","name":"user","type":"address"}],"name":"setPlayerContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint128[5]","name":"newRarityLimits","type":"uint128[5]"}],"name":"setRarityLimitsTable","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bool","name":"_enableSeDivide","type":"bool"},{"internalType":"uint128","name":"_seDivide","type":"uint128"},{"internalType":"uint256","name":"_gracePeriod","type":"uint256"}],"name":"setSeDivide","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"tokenId","type":"uint256[]"},{"internalType":"uint128[]","name":"deduction","type":"uint128[]"},{"internalType":"address","name":"user","type":"address"}],"name":"squidEnergyDecrease","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"tokenId","type":"uint256[]"},{"internalType":"uint128[]","name":"addition","type":"uint128[]"},{"internalType":"address","name":"user","type":"address"}],"name":"squidEnergyIncrease","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"tokenFreeze","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"tokenUnfreeze","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"totalSEAmount","outputs":[{"internalType":"uint128","name":"amount","type":"uint128"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"}]')

    bsbAbi = json.loads('[{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"baseURI","type":"string"}],"name":"Initialize","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"previousAdminRole","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"newAdminRole","type":"bytes32"}],"name":"RoleAdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleGranted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleRevoked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"uint8","name":"level","type":"uint8"}],"name":"TokenMint","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[],"name":"DEFAULT_ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TOKEN_MINTER_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"allowedBusBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"allowedUserToMintBus","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"allowedUserToPlayGame","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"burn","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"busAdditionPeriod","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"firstBusTimestamp","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleAdmin","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"getToken","outputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"address","name":"tokenOwner","type":"address"},{"internalType":"uint8","name":"level","type":"uint8"},{"internalType":"uint32","name":"createTimestamp","type":"uint32"},{"internalType":"string","name":"uri","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"grantRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"hasRole","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"baseURI","type":"string"},{"internalType":"uint8","name":"_maxBusLevel","type":"uint8"},{"internalType":"uint256","name":"_minBusBalance","type":"uint256"},{"internalType":"uint256","name":"_maxBusBalance","type":"uint256"},{"internalType":"uint256","name":"_busAdditionPeriod","type":"uint256"}],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"maxBusBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minBusBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint8","name":"_busLevel","type":"uint8"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"renounceRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"revokeRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"seatsInBuses","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"secToNextBus","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"newBaseUri","type":"string"}],"name":"setBaseURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint8","name":"_maxBusLevel","type":"uint8"},{"internalType":"uint256","name":"_minBusBalance","type":"uint256"},{"internalType":"uint256","name":"_maxBusBalance","type":"uint256"},{"internalType":"uint256","name":"_busAdditionPeriod","type":"uint256"}],"name":"setBusParameters","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"}]')

    gameAbi = json.loads('[{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"gameIndex","type":"uint256"}],"name":"GameAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"gameIndex","type":"uint256"}],"name":"GameDisable","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"gameIndex","type":"uint256"}],"name":"GameEnable","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"uint256","name":"gameIndex","type":"uint256"},{"indexed":false,"internalType":"bool","name":"userWin","type":"bool"},{"indexed":false,"internalType":"address[]","name":"rewardTokens","type":"address[]"},{"indexed":false,"internalType":"uint128[]","name":"rewardAmount","type":"uint128[]"}],"name":"GamePlay","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"gameIndex","type":"uint256"}],"name":"GameSetNewGameParam","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"gameIndex","type":"uint256"}],"name":"RewardTokenChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"previousAdminRole","type":"bytes32"},{"indexed":true,"internalType":"bytes32","name":"newAdminRole","type":"bytes32"}],"name":"RoleAdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleGranted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"role","type":"bytes32"},{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RoleRevoked","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"components":[{"internalType":"address","name":"token","type":"address"},{"internalType":"uint128","name":"rewardInUSD","type":"uint128"},{"internalType":"uint128","name":"rewardInToken","type":"uint128"}],"indexed":false,"internalType":"struct MainSquidGame.RewardToken[]","name":"_rewardBalance","type":"tuple[]"}],"name":"Withdrew","type":"event"},{"inputs":[],"name":"DEFAULT_ADMIN_ROLE","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"uint128","name":"minSeAmount","type":"uint128"},{"internalType":"uint128","name":"minStakeAmount","type":"uint128"},{"internalType":"uint256","name":"chanceToWin","type":"uint256"},{"components":[{"internalType":"address","name":"token","type":"address"},{"internalType":"uint128","name":"rewardInUSD","type":"uint128"},{"internalType":"uint128","name":"rewardInToken","type":"uint128"}],"internalType":"struct MainSquidGame.RewardToken[]","name":"rewardTokens","type":"tuple[]"},{"internalType":"string","name":"name","type":"string"},{"internalType":"bool","name":"enable","type":"bool"}],"internalType":"struct MainSquidGame.Game","name":"_game","type":"tuple"}],"name":"addNewGame","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"components":[{"internalType":"uint32","name":"duration","type":"uint32"},{"internalType":"uint128","name":"priceInUSD","type":"uint128"},{"internalType":"bool","name":"enable","type":"bool"}],"internalType":"struct MainSquidGame.PlayerContract","name":"_playerContract","type":"tuple"}],"name":"addPlayerContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"autoBsw","outputs":[{"internalType":"contract IautoBsw","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"bswToken","outputs":[{"internalType":"contract IERC20Upgradeable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"busNFT","outputs":[{"internalType":"contract ISquidBusNFT","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256[]","name":"_tokensId","type":"uint256[]"},{"internalType":"uint256","name":"_contractIndex","type":"uint256"}],"name":"buyContracts","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"checkGameRequirements","outputs":[{"internalType":"bool","name":"busAndPlayersAmount","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decreaseWithdrawalFeeByDay","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_gameIndex","type":"uint256"}],"name":"disableGame","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_gameIndex","type":"uint256"}],"name":"enableGame","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"firstGameCountdownSE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"games","outputs":[{"internalType":"uint128","name":"minSeAmount","type":"uint128"},{"internalType":"uint128","name":"minStakeAmount","type":"uint128"},{"internalType":"uint256","name":"chanceToWin","type":"uint256"},{"internalType":"string","name":"name","type":"string"},{"internalType":"bool","name":"enable","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getGameCount","outputs":[{"internalType":"uint256","name":"count","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getGameInfo","outputs":[{"components":[{"internalType":"uint256","name":"index","type":"uint256"},{"components":[{"internalType":"uint128","name":"minSeAmount","type":"uint128"},{"internalType":"uint128","name":"minStakeAmount","type":"uint128"},{"internalType":"uint256","name":"chanceToWin","type":"uint256"},{"components":[{"internalType":"address","name":"token","type":"address"},{"internalType":"uint128","name":"rewardInUSD","type":"uint128"},{"internalType":"uint128","name":"rewardInToken","type":"uint128"}],"internalType":"struct MainSquidGame.RewardToken[]","name":"rewardTokens","type":"tuple[]"},{"internalType":"string","name":"name","type":"string"},{"internalType":"bool","name":"enable","type":"bool"}],"internalType":"struct MainSquidGame.Game","name":"game","type":"tuple"},{"internalType":"bool","name":"playerAndBusAmount","type":"bool"},{"internalType":"bool","name":"bswStake","type":"bool"},{"internalType":"bool","name":"seAmount","type":"bool"}],"internalType":"struct MainSquidGame.GameInfo[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"}],"name":"getRoleAdmin","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getUserRewardBalances","outputs":[{"internalType":"address[]","name":"","type":"address[]"},{"internalType":"uint128[]","name":"","type":"uint128[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"grantRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"hasRole","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"contract IERC20Upgradeable","name":"_usdtToken","type":"address"},{"internalType":"contract IERC20Upgradeable","name":"_bswToken","type":"address"},{"internalType":"contract ISquidBusNFT","name":"_busNFT","type":"address"},{"internalType":"contract ISquidPlayerNFT","name":"_playerNFT","type":"address"},{"internalType":"contract IOracle","name":"_oracle","type":"address"},{"internalType":"contract IMasterChef","name":"_masterChef","type":"address"},{"internalType":"contract IautoBsw","name":"_autoBsw","type":"address"},{"internalType":"address","name":"_treasuryAddress","type":"address"},{"internalType":"uint256","name":"_recoveryTime","type":"uint256"}],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"masterChef","outputs":[{"internalType":"contract IMasterChef","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"oracle","outputs":[{"internalType":"contract IOracle","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_gameIndex","type":"uint256"},{"internalType":"uint256[]","name":"_playersId","type":"uint256[]"}],"name":"playGame","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_pcIndex","type":"uint256"},{"internalType":"uint128","name":"newPrice","type":"uint128"},{"internalType":"bool","name":"_state","type":"bool"}],"name":"playerContractState","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"playerContracts","outputs":[{"internalType":"uint32","name":"duration","type":"uint32"},{"internalType":"uint128","name":"priceInUSD","type":"uint128"},{"internalType":"bool","name":"enable","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"playerNFT","outputs":[{"internalType":"contract ISquidPlayerNFT","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"recoveryTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"renounceRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"role","type":"bytes32"},{"internalType":"address","name":"account","type":"address"}],"name":"revokeRole","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_gameIndex","type":"uint256"},{"internalType":"uint128","name":"_minSeAmount","type":"uint128"},{"internalType":"uint128","name":"_minStakeAmount","type":"uint128"},{"internalType":"uint256","name":"_chanceToWin","type":"uint256"}],"name":"setGameParameters","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newRecoveryTime","type":"uint256"}],"name":"setRecoveryTime","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_gameIndex","type":"uint256"},{"components":[{"internalType":"address","name":"token","type":"address"},{"internalType":"uint128","name":"rewardInUSD","type":"uint128"},{"internalType":"uint128","name":"rewardInToken","type":"uint128"}],"internalType":"struct MainSquidGame.RewardToken[]","name":"_rewardTokens","type":"tuple[]"}],"name":"setRewardTokensToGame","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_treasuryAddress","type":"address"}],"name":"setTreasuryAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_decreaseWithdrawalFeeByDay","type":"uint256"},{"internalType":"uint256","name":"_withdrawalFee","type":"uint256"}],"name":"setWithdrawalFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"treasuryAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"unpause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"usdtToken","outputs":[{"internalType":"contract IERC20Upgradeable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"userInfo","outputs":[{"components":[{"internalType":"uint256","name":"busBalance","type":"uint256"},{"internalType":"uint256","name":"allowedBusBalance","type":"uint256"},{"internalType":"uint256","name":"secToNextBus","type":"uint256"},{"internalType":"uint256","name":"playerBalance","type":"uint256"},{"internalType":"uint256","name":"allowedSeatsInBuses","type":"uint256"},{"internalType":"uint256","name":"availableSEAmount","type":"uint256"},{"internalType":"uint256","name":"totalSEAmount","type":"uint256"},{"internalType":"uint256","name":"stakedAmount","type":"uint256"},{"internalType":"uint256","name":"bswBalance","type":"uint256"},{"components":[{"internalType":"address","name":"token","type":"address"},{"internalType":"uint128","name":"rewardInUSD","type":"uint128"},{"internalType":"uint128","name":"rewardInToken","type":"uint128"}],"internalType":"struct MainSquidGame.RewardToken[]","name":"rewardBalance","type":"tuple[]"},{"internalType":"uint256","name":"currentFee","type":"uint256"}],"internalType":"struct MainSquidGame.UserInfo","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"withdrawReward","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"withdrawTimeLock","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"withdrawalFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]')

    bspContract = web3Utils.w3.eth.contract(address=web3Utils.w3.toChecksumAddress(bspAddress), abi=bspAbi)

    bsbContract = web3Utils.w3.eth.contract(address=web3Utils.w3.toChecksumAddress(bsbAddress), abi=bsbAbi)

    gameContract = web3Utils.w3.eth.contract(address=web3Utils.w3.toChecksumAddress(gameAddress), abi=gameAbi)

    def __init__(self):
        '''构造函数

        '''
        pass

    def array_user_players(self, address):
        '''获取钱包所有玩家
        Args:
            address (str): 钱包地址
        Returns:
            players[]: 玩家数组
        '''
        pass
        players = []
        arrayUserPlayers = self.bspContract.functions.arrayUserPlayers(address).call()
        for arrayUserPlayer in arrayUserPlayers:
            player = Player(arrayUserPlayer[0], arrayUserPlayer[1] + 1,
                            self.web3Utils.w3.fromWei(arrayUserPlayer[3], 'ether'),
                            self.web3Utils.w3.fromWei(arrayUserPlayer[4], 'ether'),
                            arrayUserPlayer[5], arrayUserPlayer[6],
                            arrayUserPlayer[7])
            players.append(player)
        return players

    def playGame(self, key, nonce,gameIndex, playersId):
        '''进行游戏
        Args:
            key (str): 钱包密钥
            gameIndex (int): 游戏编号 0-6对应1-7游戏
            playersId[]: 玩家IDS
        Returns:
            tx(str): 链上txhash
        '''
        pass
        account = self.web3Utils.get_account(key)
        func = self.gameContract.functions.playGame(gameIndex, playersId)
        params = {
            "from": account.address,
            "value": self.web3Utils.w3.toWei(0, 'ether'),
            'gasPrice': self.web3Utils.gwei,
            "gas": 1000000,
            "nonce": nonce,
        }
        return self.web3Utils.sign_send(func, params, key, "进行游戏")

class Player:
    '''鱿鱼游戏玩家NFT类

    Attributes:
        id: 玩家ID(NFTID)
        level: 玩家等级(1-5)
        se: 玩家能量
        seMax: 玩家能量上限
        contractTime: 玩家合同时间
        unLockTime: 玩家解锁游戏时间
        createTime: 玩家创建时间
        时间属性全部是时间戳，能量和能量上线要从wei转换成数字
    '''
    def __init__(self, id, level, se, seMax, contractTime, unLockTime, createTime):
        self.id = id
        self.level = level
        self.se = se
        self.seMax = seMax
        self.contractTime = contractTime
        self.unLockTime = unLockTime
        self.createTime = createTime

